---
title: 腾讯云服务器Linux机器学习初学环境配置指南
categories: 技术杂谈
date: 2022/11/01
---
# 腾讯云服务器Linux机器学习初学环境配置指南
## 服务器选购
腾讯云服务器对学生有首次购买优惠，对比华为云和阿里云，性价比相对更高。矩池云的学生优惠力度也比较大，但是学生优惠只能按照运行时间（卡时）计费，包月价格仍然较贵。  
在如下页面：https://cloud.tencent.com/act/campus  

购买学生服务器，购买之前需要在腾讯云个人账户信息页面完成实名认证。需要注意的是，每个学生账号对每类商品只能享受一次优惠，因此推荐购买时长较长（三个月或者包年）的配置。  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101101944.png width=80%>  
点击购买后会弹出窗口选择配置，此处选择的操作系统为Ubuntu Server 18.04，配置如下图所示：  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101102846.png width=50%>  

完成购买后，页面会自动跳转到控制台，选择刚才购买的服务器实例，对其开机后，点击右侧登陆即可进入该服务器内部。  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101103630.png width=50%>  
{% note info %}  
点击登陆后有可能要求扫码登陆服务器，浏览器可能会拦截弹出的服务器实例窗口。  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101103933.png width=30%>  
{% endnote %}  
在弹出的服务器实例登陆窗口中，填写密码（购买服务器后密码在个人中心的消息中查看）  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101104141.png width=50%>  

登陆后即可进入Ubuntu的bash界面：  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101104253.png width=50%>  

## Ubuntu 环境配置
### apt
首次使用`apt-get`时可能会出现如下报错：
```
>> Could not get lock /var/lib/apt/lists/lock - open (11: Resource temporarily unavailable)  
```
需要通过如下命令解锁apt占用的资源：  
```bash
sudo rm /var/cache/apt/archives/lock
sudo rm /var/lib/dpkg/lock
```
之后就可以正常使用`sudo apt-get upgrade`命令更新apt源了，腾讯云服务器的Linux实例默认使用的apt源为腾讯云Linux镜像，因此无需进行换源操作。  
在Linux中可以使用apt安装包管理程序安装应用，比如下载firfox浏览器：  
```bash
sudo apt-get install firfox
```
一些apt源中未含有的软件就需要自己手动添加源进行安装，比如安装VScode正式版：  
```bash
sudo apt-get install wget gpg
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > packages.microsoft.gpg
sudo install -D -o root -g root -m 644 packages.microsoft.gpg /etc/apt/keyrings/packages.microsoft.gpg
sudo sh -c 'echo "deb [arch=amd64,arm64,armhf signed-by=/etc/apt/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main" > /etc/apt/sources.list.d/vscode.list'
rm -f packages.microsoft.gpg
sudo apt install apt-transport-https
sudo apt update
sudo apt install code
```

### 安装英伟达GPU驱动
#### 检查依赖和环境
执行如下命令检查系统中是否已经安装dkms：
```bash
dpkg -l | grep -i dkms
```
如果出现`>> ii dkms... Dynamic Kernel Module Support Framework`消息则表示安装成功，否则需要使用`sudo apt-get install dkms`安装dkms。  
执行如下命令检查系统中是否已经安装gcc和linux-kernel-headers：
```bash
dpkg -l | grep -i gcc
dpkg -l | grep -i linux-headers
```
如果可以弹出linux下gcc和linux-kernel-headers相关文件列表，则表明系统中已经安装了这两个依赖包。如果返回为空则需要使用`sudo apt-get install gcc linux-kernel-headers`安装这两个包。  

#### 下载并安装驱动
在自己的电脑上前往英伟达官方驱动下载页面：[Download Drivers](https://www.nvidia.com/Download/index.aspx?lang=en-us) 选择对应的产品和驱动。  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101161638.png width=50%>  
当出现以下页面时，右键单击 AGREE&DOWNLOAD 并选择菜单中的复制链接地址。如下图所示：
<img src= https://main.qcloudimg.com/raw/e0412e1a06eb06ad9f98e7f6a2d5a026.png width=50%>  

使用`wget`下载这个驱动（需要把链接最后的`&lang=us&type=Tesla`删除，`xxx`是下载的驱动的版本号）：  
```bash
wget https://www.nvidia.com/content/DriverDownload-March2009/confirmation.php?url=/tesla/xxx.xxx/NVIDIA-Linux-x86_64-xxx.xxx-diagnostic.run
```
下载好后修改安装包权限（`xxx`是下载的驱动的版本号）：  
```bash
chmod +x NVIDIA-Linux-x86_64-xxxx.run
```
使用bash对其进行安装，需要注意的是安装的时候要使用自定义设置`--disable-nouveau --no-install-libglvnd`关闭veau验证等等：  
```bash
sudo sh NVIDIA-Linux-x86_64-xxxx.run --ui=none --disable-nouveau --no-install-libglvnd --dkms -s  
```
安装结束后使用：`nvidia-smi`验证结果，出现下图则表示安装成功。  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101162358.png width=50%>


### gnome图形界面配置
{% note warning %}  
Gnome可能会与Nvidia GPU 驱动冲突导致无法启动。  
{% endnote %}  
初学者可能对Linux无图形界面的bash命令行感到陌生，可以安装gnome实现图形界面进行人机界面交互，基础版的gnome桌面需要使用apt下载如下两个包：  
```bash
sudo apt-get install ubuntu-desktop
sudo apt-get install gnome
```
安装完成后，使用`sudo reboot`指令重启服务器，然后关闭bash界面，退回到腾讯云控制台重新登陆服务器实例。在登陆页面选择VNC登陆：  
<img src= https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20221101105724.png width=50%>  

登陆后即可进入Ubuntu的开箱设置页面，完成设置后出现gnome桌面。  

