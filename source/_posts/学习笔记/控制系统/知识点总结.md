---
title: 控制系统-知识点总结
date: 2022/06/09
category_bar: true
categories: 
- 学习笔记
- 控制系统
---
# 控制系统-知识点总结

{% note warning %}  
注意：考试当中所有的作图必须作在指定的坐标纸中，否则零分！  
{% endnote %}  

# 模拟控制系统
## 系统的频率响应
对系统的传递函数$H(s)$，根据s域定义$s=jω,j^2=-1$，得到：   
$$H(jω)=H(s)|_{s=jω}$$
$H(jω)$称为系统的频率响应。  
定义系统方程$H(jω)$的幅度值-频率响应为其转换方程的绝对值表达：  
$$|H(jω)|$$
以分贝形式表达为：  
$$|H(jω)|_{dB}=20lg|H(jω)|$$
系统方程$H(jω)$的相位-频率响应为其转换方程的实部和虚部组成的夹角：  
$$∠H(jω)=arctan\frac{Im[H(jω)]}{Re[H(jω)]}$$
系统的频率响应可以由幅频响应和相频响应两部分表示：  
$$H(jω)=|H(jω)|e^{j∠H(jω)}$$
系统的频率响应、幅频响应和相频响应在复平面上可以表示为：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220303200958.png width=50%>  

### 传递函数的级联
对于系统传递函数：  
$$H(s)=\frac{K∏(s+z_i)}{∏(s+p_i)}$$
如果将每一个括号的常数项进行归一化，就得到系统传递函数的级联形式：  
$$H(s)=\frac{K∏z_i(\frac{1}{z_i}s+1)}{∏p_i(\frac{1}{p_i}s+1)}$$
对级联系统，其每一个子系统的传递函数为$F_i(jω)$，有整个系统的传递函数：  
$$F(jω)=∏F_i(jω)$$
系统的幅值和相位为：  
$$|F(jω)|=∏\frac{|F_{zero/i}(jω)|}{|F_{pole/i}(jω)|}$$
$$∠F(jω)=∑∠F_i(jω)$$
可以发现，整个系统的波特图可以通过各子部分的波特图叠加得到。**因此，对任何一个传递函数，其整个波特图都可以被分解为若干个元素的波特图的叠加**。  

## 系统的频率响应分析
### 极坐标图
极坐标图最大的优点是能够在一张图上同时反应幅度值和相位随着频率的变化情况。极坐标图可以绘制在直角坐标上，也可以绘制在极坐标上。   

#### 极坐标图(直角坐标)的画法
1. 对$H(jω)$分子分母同时乘以分母的共轭部分，并$H(jω)$的分离出实部和虚部
2. 找到$ω=0$在极坐标上点
3. 找到$ω=∞$在极坐标上的点
4. 列方程，找到实部$Re[H(jω)]=0$时对应的$ω$，并在极坐标上找到对应的点
5. 列方程，找到虚部$Im[H(jω)]=0$时对应的$ω$，并在极坐标上找到对应的点
6. 找到可能的$ω$为其他值时在极坐标上对应的点
7. 从$ω=0$的点开始，划出连接所有点的轨迹，直到最终到达$ω=∞$的点，并标出箭头  

{% note info %}  
方程$Re[H(jω)]=0$和$Im[H(jω)]=0$根的个数决定了频率响应曲线会穿过坐标轴多少次。  
{% endnote %}

### 奈奎斯特图
极坐标图的优点是能用一条曲线同时反映系统的幅频响应和相频响应，但是相比于波特图，极坐标图无法直接通过观察曲线走向得到系统的稳定性分析，因此需要引入奈奎斯特稳定性判据理论，以此对极坐标图进行改进，改进后的极坐标图称为奈奎斯特图，其优点是用一条曲线同时反映系统的幅频响应和相频响应，也能够通过曲线直接判断系统的稳定性，但是对系统频率响应特征的反映没有波特图直观。  

#### 奈奎斯特曲线的画法
奈奎斯特路径为一段在s域上的闭合矢量路径，其涵盖了s域的右半轴，如下图所示：   
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220304101920.png width=50%>  

奈奎斯特曲线的画法如下：  
1. 绘制出$G(s)H(s)$的极坐标图，代表$G(s)H(s)$的频率响应曲线，对应路径i
2. 绘制出$G(s)H(s)$的频率响应曲线以实轴为对称轴的镜像，对应路径iii
3. - 路径ii(奈奎斯特图上从$0^-$到$0^+$的路径)在$F(s)$中对应原点(0,0)。  
   - 此外，如果系统的开环极点在奈奎斯特路径的i和iii上，此时这段绕过的路径对应将路径i和iii的映射以$R→∞$的半圆首尾($0^-→0^+$)连接的路径。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220304112314.png width=50%>    

第三步补充路径的方法如下图所示：    
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220304115220.png width=50%>   

#### 奈奎斯特图分析
- 奈奎斯特判据  
  **当频率$ω$从$-∞$向$+∞$变化时，$GH$平面上奈奎斯特曲线包围点$(-1,0)N$次**，当
  $$Z=P-N=0$$
  其中$P$为系统开环传递函数$G(s)H(s)$的在s域右半轴的极点个数  
  $N$拥有极性，逆时针包围点$(-1,0)$时$N>0$,顺时针包围点$(-1,0)$时$N<0$   
  **系统在s域右半轴不存在任何极点，表明系统是稳定的。**
- 根据稳定性判断系统传递函数参数  
对系统开环传递函数$G(s)=\frac{K}{∏(s+p_i)}$，如果系统稳定，那么$N=P$。需要找到奈奎斯特曲线与实轴的所有交点：$(c_i,0)$，并判断其与$-\frac{1}{K}$的大小，根据$N=P$的临界条件来确定$K$的取值范围。   
当奈奎斯特曲线正好穿过点(-1,0)时，系统处于临界稳定状态，系统的稳定和不稳定处于随机中。  

- 增益裕量和相位裕量  
  定义增益裕量(Gain margin)$G_m$为使得系统处于临界稳定状态的增益。增益裕度可以通过奈奎斯特图上表示为相位角为$-180°$时对应的幅值$-\frac{1}{a}$求得：  
  $$G_m|_{dB}=20lg(a)$$
  定义相位裕量(Phase margin)$P_m$为使得系统处于系统处于临界稳定状态的相位。相位裕量可以通过奈奎斯特图上单位圆与奈奎斯特图交点连线与实轴的负半轴夹角测量得到，如下图所示：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220306085527.png width=40%>

- 灵敏度函数  
  如果开环传递函数为$G(s)H(s)$，定义系统的灵敏度函数(sensitivity function)为：  
  $$S(s)=\frac{1}{1+G(s)H(s)}$$
  灵敏度函数的最大值$M_{s}$可以反应系统的鲁棒性。而灵敏度穿越频率（sensitivity crossover frequency）指灵敏度函数幅值为1时对应的角频率，以$ω_{sc}$表示。  
  在奈奎斯特图上，$1+GH$可以表示为-1到奈奎斯特曲线的向量，$\frac{1}{M_{s}}$是-1到奈奎斯特曲线的最短距离。  
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220304121001.png width=40%>  

### 波特图
#### 绘制渐进波特图的方法
1. 将传递函数改写为级联形式  
2. 列出系统传递函数中所有的零点和极点，从小到大排列，从而将整个系统的波特图分为几个区间  
3. 找到初始值：  
   - 对幅频响应：  
     - 如果存在$s^n$项，波特图的起始幅值应当为：  
        $$±20nlg(ω_0)+20lg(K)$$
        $ω_0$为波特图横轴的起始频率，$+20nlg(ω_0)$:$s^n$位于分子；$-20nlg(ω_0)$:$s^n$位于分母。  
     - 如果不存在$s$项，波特图的起始幅值应当为：  
        $$20lg(K)$$
    - 对相频响应：  
      - 如果存在$s^n$项，波特图的起始相位应当为$90°n$  
      - 如果不存在$s^n$项，波特图的起始相位应当为$0°$   
4. 看系统方程的每个元素在对每段区间波特图的斜率贡献：  
   - 对幅频响应：  
     - 对每一个$n$阶数项，其极点会给幅频响应带来一个$-20×n dB/decade$频程斜率的变化；其零点会给幅频响应带来一个$+20×n dB/decade$频程斜率的变化。  
   - 对相频响应：  
     -  对每一个$n$阶数项，其极点会在$ω∈(\frac{0.1}{T},\frac{10}{T})$提供$-45°×n /decade$的斜率变化；其零点会在$ω∈(\frac{0.1}{T},\frac{10}{T})$提供$+45°×n /decade$的斜率变化。  
     - 对每一个$n$阶数项，其极点会给相频响应带来一个$-90°×n$的相位变化；其零点会给相频响应带来一个$+90°×n$的相位变化。  
5. 将每个元素的斜率贡献全部叠加，得到系统在每段区间上的斜率。  
6. 求得每个区间的终值：  
   在区间$(x_1,x_2)$上，纵轴的变化量$Δ=y_1-y_2$可以求得为：  
    $$Δ=klg\frac{x_2}{x_1}$$
    因此每一段区间的起始值为：  
    $$O=O_{-1}+Δ$$
    $O_{-1}$是上一段区间的起始值。  
  找到每一段区间的起点。  
7. 连接所有点，画图。  

#### 波特图分析
定义相位穿越频率（Phase crossover frequency）为相位波特图在-180°时对应的最小频率$ω_{pc}$。  
增益穿越频率（Gain crossover frequency）为幅值波特图在0dB时对应的最小频率$ω_{gc}$。  

- 增益裕量和相位裕量  
  在波特图上，  
  增益裕量是0dB与相位穿越频率对应的幅值之差：  
  $$GM|_{dB}=0-|H(jω_{pc})|=20lg(K_g)$$
  其中$K_g$为开环增益。  
  相位裕量是增益穿越频率对应的相位与-180°之差：  
  $$PM=∠H(jω_{gc})-(-180°)$$
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220307111837.png width=50%>

- 增益裕量和相位裕量与稳定性  
  **如果相位裕量和增益裕量都大于0，**则系统稳定**。  
  如果相位裕量和增益裕量都为0，则系统处于临界稳定。  
  如果相位裕量和增益裕量中有一个小于零，则系统不稳定。**  
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220307112342.png width=60%>  


#### 从波特图反推开环传递函数
- 阻尼和固有频率  
  当相位裕量小于60°时，相位裕量、阻尼、带宽之间有如下关系：  
  $$PM=100°ζ$$
  $$\frac{B}{ω_n}=1-0.5ζ$$
  其中$B$是系统带宽，是幅值为-3dB对应的频率。  
  可以通过波特图找出相位裕量和带宽，以此求得二阶系统的阻尼和固有频率。  

- 系统增益  
  系统增益满足：  
  $$α=20lgK±20N_0lgω_0$$
  其中$ω_0$为初始频率，$α$为初始频率对应的幅值，$N_0$为$s^{N_0}$的阶。  
  如果存在$s^{N_0}$项，那么波特图第一段的斜率为$±20N_0$.  

- 终段斜率与系统阶数  
  系统波特图的最后一段斜率与系统阶数关系为：  
  $$k=-20O$$
  $O$是系统的阶，即极点数-零点数。  

- 积分和微分环节  
  可以根据初始斜率判断积分/微分环节$s$的存在：  
  初始斜率为$±20N_0$，如果初始斜率为正，则代表系统存在$N_0$个积分环节，如果初始斜率为负，则代表系统存在$N_0$个微分环节。  

- 一阶和二阶项结构  
  根据之前的讨论可以知道：  
  - 系统波特图上的转折点对应频率为系统的零点或者极点
  - 波特图上发生斜率变化一定由加入的零点/极点极点造成：一阶项对初始斜率的贡献为$20dB$,二阶项对斜率的贡献为$40dB$。如果元素位于分母（极点），则斜率贡献为负，如果元素位于分子（零点），则斜率贡献为正。    
  根据这两条理论则可以判断每一个区间上影响其斜率变化的极点/零点结构类型。  
  如果存在修正，可以根据在固有频率处修正前后的幅值差求得$ζ$:  
  $$M_c=20lg(2ζ)$$

## 系统的阶跃响应
### 稳态误差
$$e_{ss}=1-\lim_{s→0}sY(s)$$

#### 误差系数
误差系数为：  
$$K=\lim_{s→0}s^nG(s)$$
$n=0$：静态误差系数；$n=1$：速度误差系数；$n=2$：加速度误差系数 

### 阶跃响应与传递函数*
#### 非最小相位
当系统的传递函数稳定，且在s域右半平面存在零点时，称系统是非最小相位系统。  
最小相位系统在波特图上高频稳定区域的相位角应当为$-90°r$，其中$r$是传递函数分子分母最高次数的差值。非最小相位系统在高频的相位角不存在如上的关系。    

#### 过零次数
如果真分传递函数$G(s)$中存在奇数个正零点，其正零点的个数对应拐点的个数，也是其阶跃响应过零(crossing zero)的次数。  
{% note warning %}  
过零次数不包括点(0,0)。  
{% endnote %}  

如果系统是非最小相位的，则不能保证其过零次数一定为正零点个数。  

#### 初始下冲
初始下冲（initial undershoot）指在初始点偏离阶跃响应最终的渐近方向。  
如果真分传递函数$G(s)$中存在奇数个正零点，或者严格真分传递函数$G(s)$的$G(s)-G(∞)$存在奇数个正零点那么对应的系统会出现初始下冲。如果系统是非最小相位的，则不能保证出现初始下冲。  
<center class="half">
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220309103736.png width=30%>
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220309103819.png width=30%>
</center>  

## 补偿器设计
## 超前补偿和滞后补偿
### 滞后补偿
对于PI控制器：$G_c(s)=\frac{K(s+\frac{1}{T_i})}{s}$，由于积分项$\frac{1}{s}$的出现导致PI控制器在加入系统后会改变系统原本的类型，进而改变已经调整好的系统动态响应（系统达到稳态前的响应）。因此，需要一种补偿使其能在$s=0$时提供非常大的开环增益，进而减小稳态误差，但是在高频区保持增益为1，进而不会对系统的动态响应产生影响，这样的补偿称为滞后补偿(lag compansation)。  
$$G_{lag}(s)=\frac{τs+1}{ατs+1},α>1$$

#### 滞后补偿器设计
滞后补偿器设计的思路是利用补偿将现在系统的幅度响应在补偿器设计要求的相位裕量处调整到0dB。  
- 利用稳态误差的定义，找到系统增益$K$
- 绘制出$KG(s)H(s)$的波特图，从波特图上寻找系统的相位裕量$PM$
- 在波特图上找到符合补偿器设计要求的相位裕量$PM'+Φ$（其中$Φ$是修正系数），找到对应的增益穿越频率$ω'_{gc}$。  
- 找到$ω'_{gc}$对应的幅值$K'$，并计算：
  $$α=10^{\frac{K'}{20}}$$
- 令:
  $$τ=\frac{10}{ω'_{gc}}$$
- 带入$α$和$τ$，得到滞后补偿器的前向传输方程$G_{lag}(s)$。  

{% note info %}
如果设计要求是阻尼比$ζ$，通常阻尼比可以通过如下公式近似为系统设计对相位裕量的要求：  
$$PM(°)⩰100ζ$$
{% endnote %}

### 超前补偿
对PD控制器：$G_c(s)=T_ds+1$，其幅值随着频率的升高而线性升高，但是这种特性会放大高频噪声，使系统抗噪性下降。因此，需要一种补偿通过增加一个极点进而在高频处降低系统幅值，这样的补偿称为超前补偿(lead compansation)。  
$$G_{lead}(s)=\frac{τs+1}{βτs+1},β<1$$ 

#### 超前补偿器设计
超前补偿器的设计思路是将相位波特图在高频处的部分进行抬升，具体的设计步骤是：  
- 利用稳态误差的定义，找到系统增益$K$
- 绘制出$KG(s)H(s)$的波特图，从波特图上寻找系统的相位裕量$PM$
- 通过公式：  
  $$φ_m=(PM'+φ_c)-PM$$
  其中$PM'$是设计要求的相位裕量，$Φ$是修正系数。  
  计算出需要抬升的相位。  
- 利用公式：  
  $$β=\frac{1-sinφ_m}{1+sinφ_m}$$
  计算得到β。  
- 在波特图上找到幅值为$10lg(β)$对应的频率$ω'_m$，令:
  $$τ=\frac{1}{ω'_{m}\sqrt{β}}$$
- 带入$β$和$τ$，得到超前补偿器的前向传输方程$G_{lead}(s)$。  



## 状态空间
### 状态空间与传递函数
根据系统传递函数的定义可知：  
$$T(s)=\frac{Y(s)}{U(s)}=C[sI-A]^{-1}B+D$$
$[sI-A]$的行列式$|sI-A|$结果为系统的特征多项式。  

### 状态空间表示与信号流图的转换
- 相位变化型  
    对传递函数$\frac{Y(s)}{U(s)}$，可将其分解为：  
    $$\frac{Y(s)}{U(s)}=\frac{V(s)}{U(s)}\frac{Y(s)}{V(s)}=\frac{∑b_is^{(m-i)}}{∑a_is^{(n-i)}}$$
    令$x_1=v$作为状态变量，对$\frac{V(s)}{U(s)}$可以得到一系列系统的状态方程。对$\frac{Y(s)}{V(s)}$可以得到系统的输出方程。  
    再根据状态方程和输出方程即可绘制信号流图。  
    <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220313141835.png width=50%>

   如果$x_1,x_2,x_3$的次序相反，那么得到的是能控标准型。  

- 能观标准型  
  对系统的传递函数$\frac{Y(s)}{U(s)}$，如果其写作如下的形式：  
  $$\frac{Y(s)}{U(s)}=\frac{b_0+b_1s^{-1}+...+b_ns^{-n}}{1+a_1s^{-1}+...+a_ns^{-n}}$$
  则可以根据这个结构直接写出系统的状态方程和输出方程：  
  $$\dot{x_k}=-a_kx_1+x_{k+1}+b+ku,1≤k≤n-1$$
  $$\dot{x_n}=-a_nx_1+b_nu$$
  $$y=x_1+b+0u$$
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220313142033.png width=50%>

- 级联型  
  如果系统的传递函数$\frac{Y(s)}{U(s)}$写作：  
  $$\frac{Y(s)}{U(s)}=\frac{(s+z)}{∏^n(s+p_i)}$$
  那么可以视为：  
  $$\frac{x_n}{u}=\frac{1}{s+p_n}⇒\dot{x_n}=-p_ix_n+u$$
  $$\frac{x_k}{x_{k+1}}=\frac{1}{s+k_n}⇒\dot{x_k}=-p_ix_k+x_{k+1}$$
  $$\frac{y}{x_1}=s+z⇒y=\dot{x_1}+zx_1$$
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220313141619.png width=50%>

- 并联型  
  如果系统的传递函数$\frac{Y(s)}{U(s)}$写作：  
  $$\frac{Y(s)}{U(s)}=∑\frac{α_i}{(s+p_i)}$$  
  那么系统的状态方程可以写作：  
  $$\dot{x_i}=-p_ix_i+α_i$$
  系统的输出方程可以写作：  
  $$y=∑α_ix_i$$
  <img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220313142926.png width=50%>  

### 能观性和能控性
#### 能观性判定
能观矩阵：  
$$\begin{bmatrix}
    C\\ - \\ CA \\ - \\ ... \\ - \\ CA^{n-1}
\end{bmatrix}$$
当系统的能观矩阵满秩（或者说能观矩阵行列式结果不为零）时，表明系统是完全能观的（completely observable）。  

#### 能控性判定
能控矩阵（controllability matrix）：  
$$[B|AB|A^2B|…|A^{n-1}B]$$
对于有$n$个状态的系统，它是一个$n×n$的方阵。当且仅当能控矩阵满秩，即其秩为$n$时，系统是完全状态能控(state controllable)的。  

### 观测器设计
#### 能观标准型设计
- 将系统原型改写为能观标准型，并检查系统原型的能观性。  
- 根据系统原型的能观标准型，得到其状态转移矩阵$Φ=A-LC$
- 根据系统的状态转换矩阵得到含有观测系数$l$的系统特征方程：$|sI-(A-LC)|=0$  
- 根据对系统设计的要求计算出要求的阻尼比$ζ$和固有频率$ω_n$，构造目标系统的特征方程。  
- 将目标系统的特征方程与$|sI-(A-LC)|=0$匹配，使用待定系数法得到观测向量$L$中的每一个元素$l$。  
  
#### 非能观标准型设计
- 找到现在系统的能观矩阵$O_z$  
- 根据$|sI-A|=0$找到现在系统的特征方程。  
- 根据特征方程，写出系统状态空间表示的能观标准型，找到系统的能观矩阵$O_x$并检验能观性。  
- 根据$P=O_z^{-1}O_x$得到$P$
- 根据相位变化型中的$A_x$，$B_x$，找到$A_x-L_xB_x$，并得到目标系统的特征方程$|sI-(A_x-L_xB_x)|=0$
- 根据设计目标求出$ω_n$和$ζ$，并构造系统的特征方程。  
- 将系统的特征方程与$|sI-(A_x-L_xB_x)|=0$进行系数匹配，得到$L_x$
- 利用$L_z=PL_x$得到$L_z$


### 控制器设计
#### 相位变化型设计
如果系统以相位变化型给出：  
- 检查系统原型的稳定性
- 根据系统设计要求中的过冲率和设置时间计算出系统要求的阻尼比$ζ$和固有频率$ω_n$，构建系统的二阶极点项：$(s^2+2ζω_ns+ω_n^2)$   
- 如果系统原型存在零点$(s+z)$，则添加新的极点项$(s+p),p=z$。  
  （此时可以得到设计要求的极点多项式为：$(s+p)(s^2+2ζω_ns+ω_n^2)$）
- $n$个反馈控制系数$-k$，并计算得到矩阵$A-BK$。  
- 找到改进后系统的特征方程$|sI-(A-BK)|=0$。  
- 将$|sI-(A-BK)|=0$与$(s+p)(s^2+2ζω_ns+ω_n)=0$的系数进行匹配，使用待定系数法即可得到所有的$k$

#### 非相位变化型设计
- 求得现在系统的控制矩阵$C_z=[B_z|A_zB_z|…|A_z^{n-1}B_z]$
- 根据$|sI-A_z|=0$找到现在系统的特征方程。  
- 根据特征方程，写出系统状态空间表示的相位变化型，找到系统相位变化型的能控矩阵$C_x=[B_x|A_xB_x|…|A^{n-1}_xB_x]$
- 检验能控性。  
- 根据$P=C_zC^{-1}_x$得到$P$
- 根据相位变化型中的$A_x$，$B_x$，找到$A_x-B_xK_x$，并得到目标系统的特征方程$|sI-(A_x-B_xK_x)|=0$
- 根据设计目标求出$ω_n$和$ζ$，并构造系统的特征方程。  
- 将系统的特征方程与$|sI-(A_x-B_xK_x)|=0$进行系数匹配，得到$K_x$
- 利用$K_z=K_xP^{-1}$得到$K_z$

# 数字控制系统
## 数字控制系统结构
数字控制系统是指控制器为数字控制器的控制系统，本课程中研究的数字控制系统的结构如下图所示：   
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220609144002.png width=50%>  

### 数字系统的数学模型
数字控制系统中可以使用差分方程描述系统的特性：  
$$∑b_ky(n+k)=∑a_kr(n+k)$$

{% note warning %}
需要注意系统的初始条件，如果规定了系统的初始条件：$y(0)≠0$、$y(1)≠0$，则应当利用z变换的时移性质：  
$$Z[f(k+1)]=zF(z)-zf(0)$$
$$Z[f(k+n)]=zF(z)-z^nf(0)-∑_{k=1}z^{n-k}f(k)$$
{% endnote %}

对差分方程两边做z变换，整理可以得到系统的闭环传递函数：  
$$TF_{cl}(z)=\frac{Y(z)}{X(z)}$$

### 稳态误差
和模拟控制系统一样，定义数字系统的稳态误差为：  
$$e_{ss}=1-\lim_{z→1}(z-1)Y(z)=1-\lim_{z→1}(z-1)TF_{cl}(z)U(z)$$
$TF_{cl}(z)$是系统的闭环传递函数。  

## 稳定性分析
### 根轨迹图
##### 通过开环传递函数绘制根轨迹图
通过开环传递函数$G(s)H(s)$直接绘制根轨迹遵循如下规则：  
- 根轨迹的分支数  
  根轨迹的分支数量是开环极点数$n$和开环零点数$m$中的最大值$max(m,n)$。  
- 根轨迹的起点和终点  
  **根轨迹的起点只能是极点，而终点要么是零点要么是无穷远处**。  
  如果开环零点数等于开环极点数，根轨迹始于开环极点，终于其左边相邻的开环零点。  
  如果开环零点数小于开环极点数，那么有$n-m$调根轨迹终止于无穷远处。  
- 实轴上的根轨迹  
  实轴上的某一区域，若其右边开环实数零极点个数之和为奇数，则该轨迹是根轨迹。或者描述为：将零极点从大到小编号为(1,2,3...)，**实轴上第奇数个零极点左边的部分是根轨迹**。  
  进入实轴的点(称为进入点(break-in point))是函数$-\frac{A(z)}{B(z)},G(z)H(z)=\frac{KB(z)}{A(z)}$的正极大值点，离开实轴的点（称为离开点(breakaway point)）是函数$-\frac{A(z)}{B(z)},G(z)H(z)=\frac{KB(z)}{A(z)}$的正极小值点。  
  两个根轨迹在实轴上相遇后立即分离的点称为和分离点，在和分离点后，两根根轨迹会向对向偏转90°。其中，**起点值较大的根轨迹向上偏转，起点值较小的根轨迹向下偏转**。  
- 复根  
  如果有复根出现，则一定是共轭成对出现的。  
- 不重叠  
  在任何时候，同一支根轨迹分支不会与自身重叠。  


### 根轨迹图与数字系统特性
对于数字系统$\frac{G(z)}{1+G(z)H(z)}$，再加入比例控制器后，其闭环传递函数写作$\frac{KG(z)}{1+KG(z)H(z)}$，此时的特征方程为：  
$$1+KG(z)H(z)=0$$

#### 稳定最大增益
根轨迹上的稳定最大增益出现在有重根的位置。对于二阶数字系统，对应特征方程的$Δ=0$时对应的增益$K$最大。  

#### 临界稳定
对数字系统，根轨迹上与单位圆的交点对应系统处于临界稳定状态。  
- 当根轨迹从实轴离开单位圆时，此时对应的极点应当为$z=-1$。  
- 当根轨迹从z域上其他地方离开单位圆时，有如下求此时系统极点的方法：  
  对于二阶数字系统，其特征方程可以写作：  
  $$az^2+bz+c=0$$
  根据求根公式，有$z=\frac{-b±\sqrt{b^2-4ac}}{2a}=\frac{-b±\sqrt{(-1)^2×(b^2-4ac)}}{2a}$，有：  
  $$z=-\frac{b}{2a}±i\frac{\sqrt{4ac-b^2}}{2a}$$
  $$|z|=\frac{c}{a}$$
  当系统处于临界稳定条件下时，$z$的模长应当为单位圆半径1，有:  
  $$|z|=\frac{c}{a}=1$$

将临界稳定时系统的极点$z$带入含有比例增益$K$的特征方程中，即可求得临界稳定时的比例增益$K_{crs}$。  

#### 临界阻尼
根轨迹和系统的受阻尼状态有如下关系：  
- 当根轨迹位于实轴时，特征方程的$Δ>0$，对应$ζ>1$，系统过阻尼。  
- 当根轨迹离开实轴时，特征方程的$Δ>=0$，对应$ζ=1$，系统处于临界阻尼状态。  
- 当根轨迹不在虚轴时，特征方程的$Δ<0$，对应$0<ζ<1$，系统欠阻尼。  

当数字系统的根轨迹离开实轴或者进入实轴时，系统处于临界阻尼状态。要系统的临界阻尼状态对应的极点即是离开点和进入点，其求法是化简特征方程，得到比例增益关于z的函数$K(z)$，对其求导且令其为0：
$$\frac{dK}{dz}=0$$
其中微分方程的解中较大的值是根轨迹的离开点，较小的值是根轨迹的进入点。  
将临界阻尼时系统的极点$z$带入含有比例增益$K$的特征方程中，即可求得临界稳定时的比例增益$K_{crd}$。  


### 朱利判据
朱利判据是一种对数字系统的稳定性判据，相比于需要先连续化特征方程的劳斯判据，朱利判据可以直接判定数字系统是否稳定。  
具体而言，对于一个$n$阶数字系统的特征多项式：  
$$F(z)=∑_{k=0}^na_{n-k}z^{n-k}$$

#### 必要条件
其稳定的必要条件是：  
$$F(1)>0$$
$$(-1)^nF(-1)>0$$

#### 充分条件
系统稳定的充分条件为：  
将特征多项式系数按照如下的朱利表进行排列：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220416152153.png width=30%>  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220609150157.png width=30%>  

排列后的系数满足：  
$$\begin{cases}
  |a_0|<a_n\\
  |b_0|>|b_{n-1}|\\
  |c_0|>|c_{n-2}|\\
  ⋮
\end{cases}$$
一共$n-1$个条件。  

对于数字系统，其特征多项式需要同时满足朱利判据中的充分条件和必要条件，该数字系统是稳定的。  

## PID控制器和补偿器设计
### 数字PID控制器的表示
| 控制器类型 | 传递函数 | 功能 |
|:-:|:-|:-|
|P控制器| $G_D(z)=K_p$| 降低上升时间 |
|I控制器| $G_D(z)=K_i\frac{z}{z-1}$ | 消去稳态误差，但是降低稳定性 |
|D控制器| $G_D(z)=K_d\frac{z-1}{z}$ | 增加稳定性，但是放大高频噪声 |
| PI控制器 | $G_D(z)=K_p+K_i\frac{z}{z-1}$ | 减少相位裕量，限制噪声 |
| PD控制器 | $G_D(z)=K_p+K_d\frac{z-1}{z}$ | 增加相位裕量，但放大系统噪声 |
|PID控制器|$G_D(z)=K_p+K_i\frac{z}{z-1}+K_d\frac{z-1}{z}$| 减小振荡，无稳态误差 |

### 离散化方法
#### 零阶保持器的离散化公式
如果零阶保持器和被控对象看做一个整体，对其进行z变换（即将整个系统放在z域中查看），得到：  
$$G_{ZA}(z)=\frac{z-1}{z}𝒵[\frac{G(s)}{s}]$$
$𝒵[⋅]$表示z变换。  
上述公式称为零阶保持器的离散化公式。  

#### 双线性变换
双线性变换由$z=e^{Ts}$使用泰勒公式对其展开：  
$$z=\frac{e^{\frac{sT}{2}}}{e^{-\frac{sT}{2}}}≈\frac{1+\frac{sT}{2}}{1-\frac{sT}{2}}$$
得到映射律：  
$$s→\frac{2}{T}\frac{z-1}{z+1}$$
其中$T$表示采样周期。   

### 离散化连续补偿器
PID补偿器设计的其中一种方法是对已经设计好的连续补偿器使用上述离散化方法对其进行数字化处理。  
具体的设计方法为：  
- 根据题目提供的条件，从根轨迹图或者劳斯判据给出的稳定条件中找到系统临界稳定条件所对应的临界增益$K_{cr}$，并找到对应的角频率$ω_{cr}$。  
- 根据$P_{cr}=\frac{2π}{ω_{cr}}$求得系统的临界振荡周期。  
- 根据齐格勒－尼科尔斯方法提供的频率响应表格完成对应的参数设计。  

齐格勒－尼科尔斯频率响应表格如下所示：  

|控制器类型|$K_p$|$K_i$|$K_d$|
|:-:|:-:|:-:|:-:|
| P控制器 | $0.5K_{cr}$ | $0$ | $0$ |
| PI控制器 | $0.45K_{cr}$ | $K_p\frac{ω_c}{1.6π}=K_p\frac{1.25}{P_{cr}}$ | $0$ |
| PID控制器 | $0.6K_{cr}$ | $K_p\frac{ω_c}{π}=0.5K_pP_{cr}$ | $K_p\frac{π}{4ω_c}=0.125P_{cr}$ | 

### 根轨迹方法
根轨迹方法是一种在Z域中进行直接设计的方法。  

#### 理论基础
- 理论一  
  根据z变换中的定义：$s=σ+jω$，$z=e^{sT}=e^{T(σ+jω)}$，有z域上任意一极点$z$:  
  $$|z|=e^{-Tσ}=e^{-Tζω_n}$$
  $$∠z=Tω_d=\frac{2πω_d}{ω_s}$$
  其中，采样次数为：  
  $$n_s=\frac{ω_s}{ω_d}$$
  工程设计中通常需要满足$8<n_s<10$。  
- 理论二  
  对于数字系统的特征方程$L(z)+1=0$，有$L(z)=-1$，此时可以将$L(z)$分解为幅度和角度，那么有：  
  $$∠L(z)=∑∠zero-∑∠pole=±180°(2k+1),k=0,1,2,...$$
  $$|L(z)|=1$$
  因此，**数字系统中某一极点与其他所有零极点的连线与实轴正半轴夹角的角度和应当为±180°。**  

#### 设计流程
对于超前/滞后补偿器$D(z)=K\frac{z+α}{z+β}$：  
- 根据系统要求找到阻尼比$ζ$、固有频率$ω_n$、阻尼固有频率$ω_d$，并找到设计的极点$z$的模长$|z|$和角度$∠z$。  
- 利用$a=|z|cos∠z,b=|z|sin∠z$将极点表示为$z=a+bj$的形式，并在z域上标出位置点$P$。  
- 将系统原型数字化，并找到系统原型的零点和极点。  
- 选择$α$为系统原型的一个极点，实现零极点对消以简化计算。  
- 将系统原型剩余的零极点与P连线的夹角利用$arctan(\frac{y_1-y_2}{x_1-x_2})$算出每一条连线与实轴正半轴的夹角。  
- 利用$∠β=∑∠zero-∑∠pole+180°$找到需要增加的零点$β$的角度。  
- 利用$∠β=arctan(\frac{b}{a-β})$求得需要增加的零点的具体位置$β$。  
- 利用$|D(z)G_{ZA}(z)|_{z=a+bj}=1$解方程求得$K$。  

对于PID控制器也可以使用同样的设计方法对其进行设计，只是其控制器结构发生变化，由于I和D控制器均存在确定的分子分母，在利用根轨迹方法设计时还需要考虑这些确定的分子分母对系统角度的贡献：  
- 对于PI控制器，其在(1,0)处贡献了一个极点。  
- 对于PID控制器，其在(0,0)和(1,0)处分别贡献了一个极点。  

<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220610152116.png width=80%>  

如果零阶保持器和系统原型的离散化写作$G_{ZA}(z)$，设计好的数字控制系统的闭环传递函数为：  
$$TF_{cl}(z)=\frac{D(z)G_{ZA}(z)}{1+D(z)G_{ZA}(z)}$$
找到其特征多项式$1+D(z)G_{ZA}(z)$后可以使用朱利判据测试其稳定性。  
如果系统稳定，可以通过$e_{ss}=1-\lim_{z→1}(z-1)Y(z)$或者静态误差系数找到其稳态误差。   

## 系统的状态空间表示
### 系统框图
#### 系统框图与能控标准型
系统框图的级联形式对应系统的能控标准型，简单来说：  
对于$\frac{Y(z)}{U(z)}=\frac{b_0+b_1z^{-1}+...+b_nz^{-n}}{1+a_1z^{-1}+...+a_nz^{-n}}$，有：  
$$\frac{Y(z)}{U(z)}=\frac{Y(z)}{H(z)}\frac{H(z)}{U(z)}$$
那么：$\frac{H(z)}{U(z)}=\frac{1}{1+a_1z^{-1}+...+a_nz^{-n}}$，$\frac{Y(z)}{H(z)}=b_0+b_1z^{-1}+...+b_nz^{-n}$。对$\frac{H(z)}{U(z)}$，有：  
$$H(z)(1+a_1z^{-1}+...+a_nz^{-n})=U(z)$$
$$H(z)=U(z)-(a_1z^{-1}+...+a_nz^{-n})H(z)$$
根据上述式子，$\frac{H(z)}{U(z)}$的信号框图可以作出，例如$H(z)=U(z)-(a_1z^{-1}+a_2z^{-2})H(z)$
的框图如下图所示：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618121826.png width=40%>  

对$\frac{Y(z)}{H(z)}$，有：  
$$Y(z)=(b_0+b_1z^{-1}+...+b_nz^{-n})H(z)$$
根据上述式子，$\frac{Y(z)}{H(z)}$的信号框图可以作出，例如$Y(z)=(b_0+b_1z^{-1}+b_2z^{-2})H(z)$的系统框图为：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618122929.png width=40%>  
将两部分合并，可以得到：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618123059.png width=50%>  

对每一个延迟器前后设置一个状态变量$x_i(k+1)$：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618123935.png width=50%>  

{% note info %}
$x_1(k+1)$和$x_2(k+1)$的位置是可以调换的，因此能控标准型有两种写法。  
{% endnote %}

对$x_1(k+1)$，可以得到：  
$$x_1(k+1)=-a_1x_1(k)-a_2x_2(k)+u(k)$$
对$x_2(k+1)$，可以得到： 
$$x_2(k+1)=x_1(k)$$
对输出$y(k)$可以得到：
$$y(k)=(b_1-b_0a_1)x_1(k)+(b_2-b_0a_2)x_2(k)+b_0u(k)$$
根据上述三个式子可以写出系统的能控标准型：  
$$\begin{bmatrix}x_1(k+1)\\x_2(k+1)\end{bmatrix}=\begin{bmatrix}-a_1&-a_2\\1&0\end{bmatrix}\begin{bmatrix}x_1(k)\\x_2(k)\end{bmatrix}+\begin{bmatrix}1\\0\end{bmatrix}u(k)$$
$$y(k)=\begin{bmatrix}b_1-b_0a_1&b_2-b_0a_2\end{bmatrix}\begin{bmatrix}x_1(k)\\x_2(k)\end{bmatrix}+b_0u(k)$$

#### 能观标准性与系统框图
对于$\frac{Y(z)}{U(z)}=\frac{b_0+b_1z^{-1}+...+b_nz^{-n}}{1+a_1z^{-1}+...+a_nz^{-n}}$，有：  
$$Y(z)(1+a_1z^{-1}+...+a_nz^{-n})=U(z)(b_0+b_1z^{-1}+...+b_nz^{-n})$$
$$Y(z)=U(z)(b_0+b_1z^{-1}+...+b_nz^{-n})-Y(z)(a_1z^{-1}+...+a_nz^{-n})$$
接下来，不断地提取$z^{-1}$项。比如对于$Y(z)=U(z)(b_0+b_1z^{-1}+b_2z^{-2})-Y(z)(a_1z^{-1}+a_2z^{-2})$，有：  
$$\begin{aligned}
     Y(z)=&U(z)b_0+z^{-1}[b_1U(z)+b_2z^{-1}U(z)-Y(z)a_1-Y(z)a_2z^{-1}]\\
     =&U(z)b_0+z^{-1}[b_1U(z)-Y(z)a_1+z^{-1}(b_2U(z)-Y(z)a_2)]
\end{aligned}$$
接下来，从最内部的$b_2U(z)-Y(z)a_2$开始构建系统，直到用框图搭建完整个系统为止，整个系统的框图如下方所示：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618132242.png width=50%>  

对每一个延迟器前后设置一个状态变量$x_i(k+1)$：   
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220618133709.png width=50%>   

{% note info %}
$x_1(k+1)$和$x_2(k+1)$的位置是可以调换的，因此能观标准型有两种写法。  
{% endnote %}

有：  
$$x_1(k+1)=-a_1x_2(k)+(b_2-a_1b_0)u(k)$$
$$x_2(k+1)=x_1(k)-a_2x_2(k)(b_1-a_2b_0)u(k)$$
$$y(k)=x_2(k)+b_0u(k)$$
综合以上三式，有：  
$$\begin{bmatrix}x_1(k+1)\\x_2(k+1)\end{bmatrix}=\begin{bmatrix}0&-a_1\\1&-a_2\end{bmatrix}\begin{bmatrix}x_1(k)\\x_2(k)\end{bmatrix}+\begin{bmatrix}b_2-a_1b_0\\b_1-a_2b_0\end{bmatrix}u(k)$$
$$y(k)=\begin{bmatrix}0&1\end{bmatrix}\begin{bmatrix}x_1(k)\\x_2(k)\end{bmatrix}+b_0u(k)$$

### 离散系统的能控性和能观性
#### 能控性判定
定义离散系统的能控性矩阵：  
$$[H|GH|…|G^{n-1}H]$$
即能控性矩阵满秩，即$|[H|GH|…|G^{n-1}H]|≠0$，则系统是能控的。  

#### 能观性判定
定义离散系统的能观性矩阵：  
$$\begin{bmatrix}
    C\\ - \\ CG \\ - \\ ... \\ - \\ CG^{n-1}
\end{bmatrix}$$
如果离散系统的能观性矩阵满秩，即$|\begin{bmatrix}
    C\\ - \\ CG \\ - \\ ... \\ - \\ CG^{n-1}
\end{bmatrix}|≠0$，则系统是能观的。    

### 反馈控制器
#### 反馈控制系统的特征方程
对于系统$\begin{cases} \vec{x}(k+1)=A\vec{x}(k)+Bu(k)\\ y(k)=C\vec{x}(k) \end{cases}$:  
添加一个负反馈控制器$K$:  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220611213830.png width=80%>    

根据上图，有系统的状态方程：  
$$x(k+1)=Ax(k)+Bu(k)$$

带入$u(k)=-kx(k)+v(k)$，有：  
$$x(k+1)=(A-BK)x(k)+Bv(k)$$
其中，
$$|zI-(A-BK)|=0$$
是系统的特征方程。  

#### 反馈控制器设计步骤
- 检验系统原型的能控性矩阵。  
- 根据系统的设计要求，找到阻尼比$ζ$和固有频率$ω_n$，并构造出系统的特征多项式。  
- 设计系统的反馈控制器，并且根据$|zI-(A-BK)|$找到系统含有$k_i$的特征多项式。  
- 通过两种方法得出的特征多项式进行系数匹配，得到$K$。  

### 观测器设计
对于系统$\begin{cases} \vec{x}(k+1)=A\vec{x}(k)+Bu(k)\\ y(k)=C\vec{x}(k) \end{cases}$: 
增加一个观测器：  

<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220502180408.png width=50%>  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220611215158.png width=50%>  

#### 观测器的功能
系统在下一个时刻的状态估计量为$\vec{\hat{x}}(k+1)$，它可以通过观测器得到：  
$$\vec{\hat{x}}(k+1)=A\vec{\hat{x}}+Bu(k)+L[y(k)-C\vec{\hat{x}}(k)]$$
设系统的观测状态误差为观测器估计的系统下一时刻状态的观测值和系统下一时刻状态的实际值之差：  
$$\vec{x_e}(k+1)=\vec{x}(k+1)-\vec{\hat{x}}(k+1)$$
结合$\vec{x}(k+1)=A\vec{x}(k)+Bu(k)$，有：  
$$\vec{x_e}(k+1)=A\vec{x_e}(k)-L[y(k)-C\vec{\hat{x}}(k)]$$
根据$y(k)=C\vec{x}(k)$，有$\hat{y}(k)=C\vec{\hat{x}}(k)$，那么：  
$$\vec{x_e}(k+1)=A\vec{x_e}(k)-L[y(k)-\hat{y}(k)]$$
可以发现，**通过调整观测器系数$L$，可以使得下一次系统的状态误差随着本次系统的输出误差的减少而减少**。  
同时，带入$y(k)=C\vec{x}(k)$，可以发现系统状态误差的转移：
$$\vec{x_e}(k+1)=A\vec{x_e}(k)-LC[\vec{x}(k)-\vec{\hat{x}}(k)]$$
即：  
$$\vec{x_e}(k+1)=(A-LC)\vec{x_e}(k)$$
那么系统状态误差的状态转移矩阵为：  
$$A-LC$$
系统的特征方程为：  
$$|zI-(A-LC)|=0$$

#### 观测器设计步骤
- 检验系统原型的能观性矩阵。  
- 根据系统的设计要求，找到阻尼比$ζ$和固有频率$ω_n$，并构造出系统的特征多项式。  
- 设计系统的反馈控制器，并且根据$|zI-(A-LC)|$找到系统含有$l_i$的特征多项式。  
- 通过两种方法得出的特征多项式进行系数匹配，得到$K$。  


# 附录：线性代数知识
## 矩阵的逆
对于二阶矩阵：$\begin{bmatrix} a & b\\ c & d \end{bmatrix}$，它的逆为：  
$$\frac{1}{ad-cd}\begin{bmatrix} d & -b\\ -c & a \end{bmatrix}$$
对于三阶矩阵$A=\begin{bmatrix} a & b & c\\ d & e & f \\ g & h & i\end{bmatrix}$，它的逆$A^{-1}$表示为：  
$$A^{-1}=\frac{adj(A)}{|A|}$$
其中，$adj(A)$称为矩阵$A$的伴随矩阵，它是$A$的代数余子式矩阵$Co(A)$的转置：  
$$adj(A)=[Co(A)]^T$$
代数余子式矩阵$Co(A)$的求法类似于行列式求法，某一位置上元素的值等于去掉这个元素所在行列之后的行列式的值，计算得到矩阵后，带入如下的符号矩阵中：  
$$\begin{bmatrix} + & - & +\\ - & + & - \\ + & -& +\end{bmatrix}$$
然后，(1,2)和(2,1)、(1,3)和(3,1)、(2,3)和(3,2)上的元素对换，得到代数余子式矩阵$Co(A)$。  

## 矩阵的特征值
设矩阵的特征值向量为$λ$，矩阵$A$的特征值向量满足：  
$$|λI-A|=0$$
可以发现，对控制系统，其特征值就是控制系统的闭环极点。  

## 对角矩阵
矩阵$A$的对角矩阵为$Λ$，其对角线上的元素为矩阵$A$的特征值，其他元素为0。设变换矩阵$P$：
$$A=PΛP^{-1}$$
$P$是多个列向量$V_i=\begin{bmatrix}v_{i1}\\v_{i2}\\v_{i3}\end{bmatrix}$的扩增矩阵:  
$$P=[V_1|V_2|...|V_n]$$
对于每个列向量$V_i$，有：  
$$(λ_iI-A)V_i=0$$