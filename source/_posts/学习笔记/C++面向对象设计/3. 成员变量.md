---
title: 3. 成员变量
date: 2023/12/11
category_bar: true
categories: 
- 学习笔记
- 面向对象设计C++
---
# 成员变量 （暂定）
{% note info %}  
这是浙江大学翁恺老师的公开课，《面向对象设计C++》  
视频地址：  
https://www.bilibili.com/video/BV1yQ4y1A7ts/?spm_id_from=333.337.search-card.all.click&vd_source=3074f6f6ab43a114c5af8727fa4f7255

本节对应视频07部分。  

{% endnote %}

## 成员变量
C语言中有本地变量（local variable）的概念，本地变量在某个函数声明中定义，且只能在这个函数中使用。C++中也有这个概念。  

```cpp
int TicketMachine::refundBalance() {
    int amountToRefound;
    amountToRefund = balance;
    balance = 0;
    return amountToRefund
}
```
比如在上面例程中，`balance`是`TicketMachine`的成员变量，而`amountToRefound`就是一个本地变量。  
和C语言不同的是，C++的成员变量和本地变量的作用域是不同的。假如在函数中定义了一个本地变量，这个本地变量的名字和某个成员变量的名字相同，这时，C语言和C++都遵从最近原则：按照最近的定义来，因此在函数中本地变量发挥作用。  

### 字段、参数和本地变量
所有三种类型的变量都能够存储一个与其定义的类型相适应的值。
字段(Field)，也就是成员变量定义在构造函数和方法之外。成员变量的值在对象的生成期中永远存在，只要对象存在，成员变量的值就随着对象存在。而本地变量的值和函数有关。因此成员变量的作用域是类，在整个类的所有成员函数中可以使用这些成员变量。而对本地变量而言，只能在所定义它的函数中去使用。  
假设现在有一个类`A`:  
```cpp
void f;
class A {
private:
    int i; //这个i是一个成员变量
public:
    void f();
}
```
在`.cpp`文件定义这个类中的函数时：  
```cpp
void A::f()
{
    int j = 10; // 这个j是一个本地变量，只能在f这个函数中才能有作用
    i = 10; //i是成员变量，在所有类为A的变量中都有用
}
```
在`main`函数中：  
```cpp
int main(){
    A a; //此处才在主程序中真正创建了一个变量i，它是私有的，无法在主程序中访问
    a.f();
    return 0;
}
```
从上面的例子可以看出，如果类中声明了一个成员变量，每一个属于这个类的变量都存在一个这个成员变量。  
参数和本地变量是相同的概念，它们的存储属性都是本地存储，只有进入到定义的函数中它们才存在。参数和本地变量都存在栈中，但是它们在栈中的存储位置是不同的。  
字段是一种成员变量，它们的访问限制在整个类当中。这个类的成员函数中可以直接使用这些成员变量。  
{% note info %}  
需要注意的是，定义和声明最大的不同是，定义会直接告诉编译器所定义内容的位置。声明只是告诉编译器之后会有这么一个声明的东西。  
{% endnote %}

### 隐藏指针this
在类中需要注意的是，类中的成员变量虽然是每个定义属于这个类的变量都拥有这样一份成员变量的拷贝，但是类中声明的函数却在整个类所有的变量中都是相同的。  

```cpp
class A{
    public:
        int i;
        void f();
};

void A::f(){
    i = 20;
    cout << i << endl;
}

int main(){
    A a;
    a.i = 10;
    cout << a.i; // 此时i的值是10
    a.f(); // 此时i的值会更改为20
    cout << a.i;
};
```
如果此时再有一个类A的变量aa`A aa`，那么函数`f`如何知道处理的`i`是`a`的`i`还是`aa`的`i`？ 这件事情可以利用指针做到：  
```cpp
class A{
    public:
        int i;
        void f();
};

void A::f(A* p){
    p -> i = 20;
    cout << p -> i << endl;
}

int main(){
    A a;
    A aa;
    a.i = 10;
    cout << a.i; // 此时i的值是10
    a.f(); // 此时i的值会更改为20
    f(&a);
    cout << a.i;
    aa.i = 100;
    aa.f();
};
```
C++中用不同的对象调用同一个函数的时候，这个函数是可以知道是哪一个类/哪一个变量在调用它的。C++里所有的成员函数都有一个隐藏参数`this`：  
```cpp
void Point::print()
```
在C++中同等于：  
```cpp
void Point:print(Point *p) //Point *p 就是 this
```
`this`是一个属于类中所有成员函数都具有的本地变量，在C++中是一个关键字，可以被直接使用，比如`this->i=20`.  