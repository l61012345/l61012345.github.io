---
title: 4.计算机局域网
date: 2022/05/15
category_bar: true
categories: 
- 学习笔记
- 通信和计算机网络
tag:
- 通信工程
- 通信网络
---
# 计算机局域网
局域网诞生的初衷是人们希望可以**通过某种方式构建一种来去自由的网络，使得各种站点之间能够自由地共享资源和收发信息**。在这个网络中，新站点的加入和旧站点的离开都不需要花费太多代价地、轻而易举地实现。 
局域网最主要的特点是：  
- 网络为一个单位所拥有；
- 地理范围和站点数目均有限。

局域网具有如下主要优点：  
- 具有广播功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
- 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
- 提高了系统的可靠性、可用性和残存性。 

局域网的主要构成有：  
- 拓扑结构
- 媒体接入控制
- 传输媒体
- 线路布局

这些主要的构成要素决定了局域网的通信效率和开销，本章只讨论前两个要素。  

## 拓扑结构
通信网络中，拓部结构是站点之间相连构成网络的方式。最基础的拓扑结构是网形和星形，由此衍生出了更复杂或者更简单的拓扑结构。  

### 总线形
总线形结构中，所有的站点通过标准的硬件接口（称为分接头）直接连接到一个线性传输媒体上。站点和分接头之间的工作模式为全双工，使得数据能够在总线上发送和接收。最基本的总线形的数据收发方式类似于广播：来自任何站点的传输沿前后两个方向传遍整个媒体，并被所有其他站点接收。总线两端是接收器，它吸收所有信号并将其排出总线。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515111944.png width=50%>  

总线形结构中，由于发送机制类似于广播，总线上所有的其他站点都可以接收到来自某个站点的传输，就需要用某种机制指明接收者。同时由于总线形的广播特性，其必须要采取一些机制/协议来处理多个站点同时向总线发信的情况来避免共道噪声、保证可靠性。  
解决这些问题的基础是各个站点以帧作为数据发送。总线形中的数据帧需要包含含有目的地的头部，总线中非目的地的站点会忽略这一帧，目的地站点会从总线上复制下这一帧。同时，各站点以某种协议合作轮流发送帧，具体的发送方式通过帧头部的控制信息确定。（这一部分的控制称为媒体接入控制）  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515113815.png width=50%>  


总线形是最简单的拓扑结构。在物理层，由于通用的硬件接口，站点的加入和离开非常的方便。但时在上层，新加入的设备必须要通过某种方式立刻知晓这些机制。  

### 树形
树形结构是对总线形结构的推广，树形从一个称为头端的点开始，延伸出多条缆线，每条缆线可以有多个分支。每条缆线可以视为一个总线形结构，缆线上有若干分接头。与总线形一样，来自任意站点的传输将传遍整个媒体，并被所有其他站点接收。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515112911.png width=50%>  

树形结构中，每个分支可以看做一个相对独立的通信环境，所有分支之间的通信资源可以共享。由于是总线形结构的推广，树形结构也同样需要考虑在总线形结构中遇到的问题。  

### 环形
环形拓扑结构由若干段**单向**链路组成，每段链路的首尾通过转发器与其他链路的首/尾相连。数据只能按照同一个方向传输，在环中沿着一个顺时针/逆时针方向循环。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515120133.png width=50%>  

环形拓扑结构中，数据同样以帧的形式发送，每一帧中的头部携带地址信息，地址对应的站点会将环上的帧复制到本地，当帧循环完所有的站点，该帧被源点删除。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515120602.png width=50%>  

环形结构中也需要媒体接入控制，最经典的控制方式是令牌环(token ring):环网中用于授权站点发信的工具称为令牌，只有在拿到令牌的情况下，站点才能够发信。令牌在整个环网中传递，站点拿到令牌后，进行发信，发信结束后，站点将令牌通过环网传递给下一个站点。如果下一个站点不发信，那么令牌继续在环网中传递。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515122722.png width=50%>  

### 星形
每一个站点通过两条点对点链路与同一个中央节点连接：一条链路负责发送，一条链路负责接收。中央节点的作用可以是实现广播功能（此时在逻辑上等同于总线形），也可以实现帧交换功能。    
一种最简单的星形结构的媒体接入控制方式是：在同一个时刻，只有一个站点可以发信。  

### 拓扑结构的选择
通常在选择拓扑结构时，考虑的因素是：  
- 性能
- 可靠性
- 可扩展性


## 媒体接入控制
媒体介入控制(Media Access Control, MAC)规定了如何协调多个发送和接收站点对一个共享传输媒体的占用。所有的局域网和城域网都是由必须共享网络传输带宽的设备集合组成的，所以需要一些对传输媒体接入进行控制的手段，以保证有序、有效地使用带宽。媒体接入控制层的关键参数是控制的位置和控制的方法。  
对于控制的位置，一般有分布式和集中式两种，集中式网络能够提供优先级，可以上各站点使用相对简单的接入逻辑，并且避免了对等实体之间的合作，但是集中控制点故障会导致整个网络出现故障。分布式则结构复杂，但是可靠性更高。  
对于控制的方法，有同步控制和异步控制两种，同步控制中，对每条连接都指定了具体的带宽，这样的方式资源利用率不高。局域网和城域网采用异步控制：异步控制可以动态地根据需求分配带宽。具体而言，异步控制分配带宽的方式有三类：循环赛、预约、竞争。  

### 循环赛(round robin)
每个站点轮流拥有发送机会，在轮到某个站点发送时，它可以选择发信或不发信。一旦该站点完成当前一轮的发送，就取消自己的发送资格，然后将权利移交至逻辑序列的下一个站点。  
循环赛的例子是令牌环网络。  

循环赛机制在只有少数站点需要发送数据时的效率最低，因为在这种情况下多数站点只是纯粹地传递发送权，站间的循环会造成相当大的额外开销。  

### 预约(reservasion)
将占用媒体的时间细分成多个时隙，不同的时隙上不同站点发送数据，想要发送数据的站点需要先预约时隙。预约具有高公平性的特点。预约适用于通信量长而持续的情况（称为流通信）：比如话音通信。  

### 争用(contention)
争用技术没有任何控制机制决定轮到哪个站点发信，而是让所有的站点粗暴地抢用媒体资源。在负荷不大的情况下，争用的效率最高，但是有非常多站点需要发信可能会导致网络崩溃。争用适用于短而零星的情况（称为突发通信），比如交互式终端与主机之间的通信。    


## IEEE 802 局域网体系结构
IEEE 802系列标准是IEEE 802 LAN/MAN 标准委员会制定的局域网、城域网技术标准。其中最广泛使用的有以太网、令牌环、无线局域网等。这一系列标准中的每一个子标准都由委员会中的一个专门工作组负责。IEEE 802协议致力于研究局域网和城域网的物理层和MAC层中定义的服务和协议，对应OSI网络参考模型的最低两层（即物理层和数据链路层）。  
下图展示了IEEE 802参考模型：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515131505.png width=50%>  

### 物理层*
IEEE 802参考模型的物理层结构和功能基本上与OSI规定的物理层没有较大差异。IEEE 802参考模型的物理层功能包括：
- 信号的编码/解码
- 前同步码（用于使接收方的时钟同步）的生成和去除
- 比特传输/接收  

### 数据链路层
由于IEEE 802委员会在标准制定时没有形成一个统一的局域网标准，而是被迫制定了几个不同的局域网标准，为了使数据链路层能够更好的适应多种局域网标准，IEEE 802参考模型中，数据链路层被划分为了两部分：逻辑链路控制层和媒体介入控制层。逻辑链路控制层的作用是向上层提供接口(LSAP)，并且进行数据链路层的差错控制和流量控制。与接入到传输媒体有关的内容都放在媒体接入控制层，而逻辑链路控制层则与传输媒体无关。  
MAC层和LLC层之间相互独立，不管采用何种协议的局域网，对 LLC 子层来说都是透明的。同时，对同一LLC层也可以使用不同的媒体接入控制协议。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220515133635.png width=50%>  

#### 逻辑链路控制层（LLC）
逻辑链路控制层（Logical Link Control layer，LLC layer）是数据链路层的两个子层之一，它涉及到物理介质拥塞管理（流拥堵和差错控制）。
该子层的两个重要功能是：
- 保证在不同网络类型中传输  
  通过在IP包上加了8位的目的地址服务接入点和源地址服务接入点实现。  
- 流量控制  
  有一个8或16位的控制字段用于像流控制的辅助功能。   

逻辑链路控制层提供了两种无连接和一种面向连接的服务：
- 方式一  
  无回复的无连接方式/不确认的无连接服务，它允许发送帧时：    
  - 给单一的目的地址（点到点协议或单点传输）  
  - 给相同网络中的多个目的地址（多点传输）  
  - 给网络中的所有地址（广播传输）  
  不确认的连接服务类似于无连接的数据报，其中不包含任何的流量控制和差错控制机制。  
  多点和广播传输在同一信息需要发送到整个网络的情况下可以减少网络流量。单点传输不能保证接收端收到帧的次序和发送时的次序相同。发送端甚至无法确定接收端是否收到了帧。  
- 方式二  
  面向连接的操作方式/连接模式服务。在两个要交换数据的用户之间建立逻辑连接。并提供流量控制和差错控制。  
- 方式三  
  有回复的无连接方式/确认的无连接服务。它仅限于点到点通信。提供的服务要求确认所发送的数据报，但是是无连接的。  

现在由于上层的标准化以及另一标准DIX Ethernet V2（与IEEE 802只有很小的差别，但是DIX Ethernet V2参考模型中没有LLC层）在标准竞争中的胜利，LLC层现在已经不常用。  

#### 媒体接入控制层（MAC）
MAC层接收来自LLC层的数据，负责执行与媒体接入和输入发送相关的功能。同其它层一样，MAC层利用这一层的协议数据单元（PDU）来实现这些功能，这一层的PDU称为MAC帧。  
以EthernetV2协议看，MAC帧结构包括了MAC层的控制信息，源点和终端的MAC地址（物理连接点的地址，通常烧录在硬件设备中，无法自主更改）以及2字节的类型，用于表示上层协议的类型，同时MAC帧包含一个用于循环冗余校验的尾部。  
**MAC帧的最小长度为64字节(即512比特)**，最长为1518字节。  
需要注意，MAC帧前面有一个8字节的前同步码+定界符，它们不属于MAC帧。  

<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220523145310.png width=50%>  


{% note info %}  
在广域网中，使用点对点连接协议(PPP)来接入ISP（同属于MAC层）。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220516120100.png width=50%>   
PPP协议非常简单，只提供点对点的接入功能。它没有以太网帧所要求的MAC地址，它通过自身的协商过程实现点到点的数据传输。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220516141531.png width=50%>  
将DIX Ethernet V2帧结构封装到PPP帧结构的协议称为PPPoE（PPP over Ethernet）.  
{% endnote %}  

## IEEE 802.3的媒体接入控制方式及其前身
IEEE 802.3工作组定义了以太网的标准技术，考虑到以太网通信以突发为主的特点，其中的媒体接入控制控制方式类别是竞争。具体而言，称为载波监听多点接入/碰撞检测协议(Carrier Sense Multiple Access with Collsion Detect,CSMA/CD)， 其技术是由最初的ALOHA协议不断改进和衍生得来。  
其名字中的“碰撞”指的是当多方同时发信时引起的冲突，这种现象在最原始的局域网中非常常见，因此局域网域又被称为“碰撞域”。  
这些媒体接入控制协议最核心的内容就是规定了如何尽可能避免碰撞或者在发生碰撞时双方的行为。在局域网中，碰撞是必须要解决的问题。  

### ALOHA和分隙ALOHA
#### ALOHA协议
ALOHA协议/纯ALOHA协议（夏威夷用于见面问候的方言）是一种非常简单的媒体接入控制方式：任何一个站都可以在帧生成后立即发送，并通过信号的反馈检测信道以确定发送是否成功。如果发信中遇到了冲突，则发信失败，该帧被丢弃，经随机延时后源点再次发送。  
随机延时的目的是减小双方发生二次碰撞的概率，这样的手段称为退避(backoff)。  
ALOHA协议虽然简单，但是冲突数量随着负载的增加而迅速增长，在ALOHA协议下，理论上信道的最大利用率为18.4%。  

#### 分隙ALOHA协议
在此基础上，分隙ALOHA将信道时间分成了若干时隙，时隙的长度对应了一帧的传输时间。新帧的产生是随机的，但分隙ALOHA不允许随机发送，凡帧的发送必须在时隙的起点。因此，冲突只发生在时隙的起点，冲突发生时只浪费一个时隙，一旦某个站占用时隙并发送成功，则在该时隙内不会出现冲突。在分隙ALOHA协议下，理论上信道的利用率提高到了36.8%。    

#### 信道利用率的推导*  
定义如下参数：  
- 帧时$T$：发送一个标准长的帧所需的时间
- 吞吐率$S$：在一个帧时T内发送成功的平均帧数（$0<S<1$，$S=1$时信道利用率100%）
- 运载负载$G$：一个帧时T内所有通信站总共发送的帧平均值（包括原发和重发帧）（$G≥S$，$G=S$表示无冲突）
- $P_0$：一帧发送成功（未发生冲突）的概率，发送成功的分组在已发送分组的总数中所占的比例；$S = GP_0$   

对ALOHA协议要想发送帧的时候不会有冲突，那么在发送一帧的时间前后都不能有其他帧发送，这段时间称为冲突危险期，时间长度应当为$2T$.  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220516131136.png width=50%>   

一个帧时内生成$k$个帧的概率服从泊松分布：$P(k)=\frac{G^ke^{-G}}{k!}$.  
根据上述推论，对ALOHA协议，$2T$的时间内都没有其它帧生成的概率为：$P_0=P(0)P(0)=e^{-2G}$，带入$S = GP_0$，得到$S=Ge^{-2G}$，其最大值为0.184.  
对分隙ALOHA协议，冲突危险期应当为$T$，$T$的时间内都没有其它帧生成的概率为：$P_0=P(0)=e^{-G}$，带入$S = GP_0$，得到$S=Ge^{-G}$，其最大值为0.368.  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220516131908.png width=50%>  

### 载波监听多点接入
在载波监听多点接入(CSMA)协议中，想要传输的站点首先监听信道，判断是否有其他站点正在传输。如果信道正在被使用（信道忙），那么该站点必须等待；如果信道空闲，站点可以传输。站点在传输后将在一段时间内等待确认(ACK)，如果没有收到确认，就假定发生了冲突并且重传。  
根据信道忙时站点的等待机制，可以将CSMA又分为：非持续CSMA、1持续CSMA和$p$持续CSMA。  

#### 非持续CSMA
非持续CSMA的策略是：  
- 如果信道空闲，则立即发信。  
- 如果信道忙，则等待一段时间，该时间长度服从重传时延的概率分布。  


非持续CSMA的缺点是，传输结束后，信道容易保持空闲，即使有一个或者多个站点等待传输。  

#### 1持续CSMA
1持续CSMA避免了信道空闲的时间，其策略是：  
- 如果信道空闲，则立即发信。  
- 如果信道忙，则等待直到信道空闲。  

在这种机制下，传输结束后的碰撞概率会随着等待的站点数目的增大而增大。  

#### $p$持续CSMA
$p$持续CSMA既避免了信道的空闲时间，又更大程度地避免了碰撞。$p$持续CSMA的策略是：  
- 如果信道空闲，那么站点有概率$p$发信，或者以$1-p$的概率等待一单位时间。  
- 如果信道忙，那么站点等待直到信道空闲。  
- 如果站点已经等待了一个单位时间，那么站点有概率$p$发信，或者以$1-p$的概率等待一单位时间。  

在这种机制下，$p$值的选取至关重要，在一单位时间后，期望发信的站点数目可以表示为：  
$$E(n)=np$$
已知$0≤p≤1$，当$E(n)≤1$时，信道中不会出现碰撞。因此，$p$如果足够小，$E(n)≥2$的概率就越小，发生碰撞的概率就越小，但是每个站点的等待时间就会更长。随着站点数$n$的增大，$p$应当动态地减小。  
$p$持续CSMA看起来是三种方案中最完美的，但是如果采用静态设置的$p$，$p$的值要设置的非常小以避免不稳定性，在$n$非常小的情况下，会带来严重的等待时延；动态设置的$p$下，新加入的站点需要知道$p$的改变，复杂的机制有悖于设置局域网的初衷。  

#### CSMA机制的选择
考虑到复杂程度和稳定性，在使用非持续CSMA的情况下，一个传输结束后，信道会保持空闲，浪费了信道容量。在使用$p$持续CSMA下，无论是动态设置还是静态设置的$p$都会有性能问题。1持续CSMA冲突的时间不长，并且由于其随机时长的退避机制，大幅度减少了二次碰撞的概率。因此在IEEE802.3标准中采用的是1持续CSMA。  


### 载波监听多点接入/碰撞检测
载波监听多点接入/碰撞检测协议(Carrier Sense Multiple Access with Collsion Detect,CSMA/CD)综合了上述几种载波监听多点接入协议的优点，其具体策略是：  
- 如果信道空闲，站点立即发信。  
- 如果信道忙，则等待直到信道空闲。  
- 如果站点检测到碰撞，在传输过程中，站点会主动发出一个干扰信号（称为积极干扰信号，jamming signal；在基带总线中，这个信号是一个高电平信号）来让整个网络中的所有站点知道碰撞的发生，之后停止传输。  
  {% note info %}  
  任意一个站点在检测到干扰信号后都会发出干扰信号，使得整个网络可以快速地知晓碰撞。  
  {% endnote %}  
  - 发送完干扰信号后，随机地等待一段时间（退避），以避免二次碰撞，之后再尝试发信。  

CSMA/CD大幅度的减少了碰撞概率，但这不意味着采用CSMA/CD的信道就完全没有碰撞。由于信号在传输线上的传输时延$τ$($τ$的参考值：**电磁波在1km电缆上的传播时延大约为5μs**)，传输线上的站点可能依然认为信道是空闲的。  
由于局域网上任意两个站点之间的传播时延有长有短，局域网按照最坏情况设计，即取总线两端的两个站点之间的传播时延为端到端的传播时延。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220517164059.png width=80%>  

从上图可以看出，**在站点发送帧后至多$2τ$（即$δ→0$）时间就可以知道所发送的数据帧是否遭受到碰撞。**  
这段时间称为争用期，可以发现，**在站点发送完数据后，在争用期时间还没有检测到碰撞，那么这次发送一定不会产生碰撞。**  
具体而言，**以太网协议规定的具体的征用时间为$2τ=51.2μs$。**
对于10Mbit/s的以太网，争用期内可以发送512bit。争用期的单位也可以用bit·s，称为比特时间表示，因此上述争用期时间也可以说为512比特时间，即争用期是发送512bit所需要的时间。  

<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220517174238.png width=80%>  

从上图发现：**在这种情况下，只有当帧长度大于$2L=r_b×2τ$**（在上文的例子中应当为512bit）**时，源站点和终端之间的任何一个站点才不可能在源站点和终端之间通信时认为信道空闲。**
因此，以太网的帧结构最小长度为64字节，即512比特。  

### 二进制截止退避
以太网使用二进制截止退避算法(truncated binary exponential backoff)来确定碰撞后重传的时期。具体的退避算法规定：  
- 基本退避时间为争用期$2τ=51.2μs$。  
- 从离散的整数集合$[0,1,2,...,2^k-1]$中随机选取一个数$r$，重传后的退避时间则为：  
  $$r×2τ$$
- 集合中的$k$在重传次数不超过10时为重传次数；当重传次数大于10时，$k=10$.  
- 当重传次数达到16次仍然不成功时，则丢弃该帧，并向上层报告。  

## 网桥
整个局域网中发生碰撞的概率随着站点数量的增加迅速上升。网桥是一种能够将碰撞域划分为两个子碰撞域的器件。各碰撞域中的碰撞概率相对独立，但是各碰撞域之间可以相互通信。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220524163250.png width=50%>  

换而言之，网桥可以在保证两个局域网相对独立的情况下，支持两个局域网之间的相互通信。  
数据帧通过网桥时，网桥不会将收到的帧在分装为一个新的帧，也不会改变帧的结构和帧的内容。网桥只是单纯地根据帧头部的信息决定是否在比特层级上复制这个帧，然后转发复制后的帧。对于站点而言，网桥的工作是透传的。  

### 地址学习
网桥需要判断某个帧是否需要通过网桥：如果帧的源地址和目的地址位于同侧，则网桥不需要将其复制到另一侧的局域网中；如果如果帧的源地址和目的地址位于异侧，则网桥需要将其复制到另一侧的局域网中。交换表的作用是为网桥提供判断源地址和目的地址是否同侧的依据，简单来说：交换表中只记录分为异侧的源地址和目的地地址，网桥会根据交换表上的信息进行转发。交换表可以预先烧录在网桥设备中，由于局域网中站点设备“来去自由”的特性，其交换表需要动态改变，因此网桥需要有自适应地址学习的功能。  
简单来说，可以分为如下几种情况：  
- 当某个帧的头部中的源地址不位于交换表中，目的地址位于交换表中且位于异侧，表明发送侧局域网中有新的站点加入。此时网桥会将数据帧转发到对应的目的地址，并记录下源地址。  
- 当某个帧的源地址位于交换表中，目的地址部存在于交换表中，目的地址是否在与发送侧不同的一侧的情况未知。此时网桥会向另一侧的局域网广播该数据帧，如果有站点接收，表明目的地址位于异侧，网桥将这次交换记录到交换表；如果没有站点接收，表明目的地址位于发送侧，网桥不会记录下这次交换。  

为了让网桥有适应拓扑变化的能力，会为每一个学习到的地址设置老化时间，一般为5分钟。超过老化时间的地址会被移除交换表。  


### 静态路由和生成树
网桥需要具备路由选择的能力，当网桥收到一个帧时，它必须决定是否转发这个帧，在多个局域网连接的情况下，还需要决定该帧转发到哪个网络。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220525134459.png width=40%>  
最简单和最常用的路由方式是之前提到过的静态路由选择。在静态路由中，网络中每个结点内部的路由表由根据某个算法生成，结点根据生成的路由表定式地转发帧。只有当整个网络的拓扑结构发生改变时，结点中的静态路由表才会改变。  
同时，网桥需要解决的一个问题是环路的问题。  
当网络中存在多个网桥的情况下，可能会引起网桥环路，环路会导致一个数据在两个网桥之间无限循环的来回传输，从而影响整个网络的性能。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220525134615.png width=40%>  

生成树算法是一种解决环路问题的拓扑结构生成算法，按照生成树算法，整个网络的拓扑结构最终会以一个无任何冗余连接的树形结构。  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220525140451.png width=40%>  

最小生成树是在生成树算法的基础上，给每个网桥端口赋一个代价值。如果没有任何特殊考虑的话，每个端口的代价都相等，这就会产生最小跳数的生成树。算法包括在所有网桥之间进行简单的消息交换，以寻找到最小代价生成树。一旦拓扑出现变化，网桥会自动重新计算生成树。  
生成树算法需要各结点之间的信息合作，因此应用生成树算法的协议称为生成树协议（STP，spanning tree protocol）。  


### 网桥和交换机
使用多个网桥将多个局域网连接在一起时，**多个网桥的集合可以看做是一个交换机**（或者称为2层交换机，因为其只涉及到物理层和MAC层）。因此，可以说网桥是交换机的前身。  
交换机工作时，实际上允许许多组端口间的通道同时工作。所以，交换机的功能体现出不仅仅是一个网桥的功能，而是多个网桥功能的集合。即网桥一般分有两个端口，而交换机具有高密度的端口。  
由于交换机能够支持多个端口，因此可以把网络系统划分成为更多的物理网段，这样使得整个网络系统具有更高的带宽。而网桥仅仅支持两个端口，所以，网桥划分的物理网段是相当有限的。  
在数据帧转发的方式上，网桥和交换机有所区别：网桥在发送数据帧前，通常要接收到完整的数据帧并执行帧检测序列FCS后，才开始转发该数据帧。交换机具有存储转发和直接转发两种帧转发方式。直接转发方式在发送数据以前，不需要在接收完整个数据帧和经过32bit循环冗余校验码CRC的计算检查后的等待时间。  

#### 局域网定义的变化
通过交换机，可以将整个碰撞域划分为更小更多的子碰撞域以进一步减小碰撞概率。极端情况下，可以使用交换机将每一个站点分割为单独的子碰撞域，即每个子碰撞域下只存在一个站点，从而真正避免了碰撞的发生。事实上，如今的网络中每一个站点都有类似的功能，其物理承载设备是网卡。在此基础上研究只有一个站点的局域网并没有太大意义，因此局域网的定义不再是单纯的一个碰撞域，而是**将由一个交换机和其连接全部站点组成的网络**称为局域网。  


{% note info %}  
在这样的环境下，媒体接入控制在只有单个站点构成的局域网中也没有太大的意义，但是上文中提到的许多媒体接入控制方式在无线通信领域仍然适用。比如基站与移动台之间的空中接口就会用到分隙ALOHA协议。  
{% endnote %}  

## 局域网之间的通信
如图所示的两个局域网通过网桥进行连接：  
<img src = https://cdn.jsdelivr.net/gh/l61012345/Pic/img/20220525162338.png width=50%>  

在发送方，用户数据传递到LLC层之后在LLC层封装后加入对应的LLC头部，然后送入MAC层。  
MAC层收到来自LLC层的DPU后加入包含MAC层控制信息、发送方MAC地址（源MAC地址）和接收方MAC地址（目的MAC地址）的头部以及加入含有校验信息的尾部后组装为MAC帧，然后将该帧送入物理层。  
在物理层，MAC帧以比特的形式发送到交换机/网桥。  
该帧的比特流被交换机/网桥的物理层接收。  
在交换机/网桥的MAC层，MAC帧的头部被检查，交换机/网桥按照MAC帧头部的地址和交换机内部缓存的路由表在物理层以比特流的形式将MAC帧转发到对应的接收站点，如果可能，交换机/网桥会启用地址学习功能动态更新路由表。  
在接收站点的物理层这个帧的比特流被接收。随后交给MAC层，MAC层去掉其头部和尾部后交付给LLC层，LLC层去掉其头部后将用户数据交付给用户。  

